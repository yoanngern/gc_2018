{"version":3,"sources":["ecommerce2/assets/js/admin.js"],"names":["require","undefined","e","t","n","r","s","o","u","a","i","f","Error","code","l","exports","call","length","1","module","ProgressBar","element","count","tick","ticks","done","progress","step_size","bar","style","width","innerText","parseInt","wrapper","document","createElement","height","border","lineHeight","boxSizing","backgroundColor","textAlign","fontWeight","color","fontSize","appendChild","2","request","url","options","XMLHttpRequest","onreadystatechange","this","readyState","status","onSuccess","responseText","onError","open","method","toUpperCase","setRequestHeader","send","data","3","start","preventDefault","button","form","querySelector","setAttribute","progress_bar","progressBarMount","progress_poll","window","setTimeout","fetchProgress","work","limit","elements","value","offset","ajaxurl","previousCount","worker","updateProgress","textElement","innerHTML","parentNode","response","new_count","location","reload","mc4wp_ecommerce","untracked_order_count","getElementById","addEventListener","./_progress-bar.js","./_request.js"],"mappings":"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","file":"admin.min.js","sourcesContent":["(function () { var require = undefined; var define = undefined; (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\nfunction ProgressBar( element, count ) {\n\tvar wrapper = element,\n\t\tbar = document.createElement('div'),\n\t\tstep_size = 100 / count,\n\t\tprogress = 0;\n\n\twrapper.style.height = \"40px\";\n\twrapper.style.width = \"100%\";\n\twrapper.style.border = \"1px solid #ccc\";\n\twrapper.style.lineHeight = \"40px\";\n\n\tbar.style.boxSizing = 'border-box';\n\tbar.style.backgroundColor = '#cc4444';\n\tbar.style.textAlign = 'center';\n\tbar.style.fontWeight = 'bold';\n\tbar.style.height = \"100%\";\n\tbar.style.color = 'white';\n\tbar.style.fontSize = '16px';\n\tbar.style.width = progress + \"%\";\n\twrapper.appendChild( bar );\n\n\tfunction tick( ticks ) {\n\t\tif( done() ) { return; }\n\n\t\tticks = ticks === undefined ? 1 : ticks;\n\t\tprogress += ( step_size * ticks );\n\t\tbar.style.width = progress + \"%\";\n\n\t\tbar.innerText = parseInt( progress ) + \"%\";\n\n\t\tif( done() ) {\n\t\t\tbar.innerText = 'Done!';\n\t\t}\n\t}\n\n\tfunction done() {\n\t\treturn progress >= 100;\n\t}\n\n\treturn {\n\t\t'tick': tick,\n\t\t'done': done\n\t}\n}\n\nmodule.exports = ProgressBar;\n},{}],2:[function(require,module,exports){\nfunction request( url, options ) {\n\n\tvar request = new XMLHttpRequest();\n\trequest.onreadystatechange = function() {\n\t\tif (this.readyState === 4) {\n\t\t\tif (this.status >= 200 && this.status < 400) {\n\t\t\t\toptions.onSuccess && options.onSuccess(this.responseText);\n\t\t\t} else {\n\t\t\t\toptions.onError && options.onError( this.status, this.responseText);\n\t\t\t}\n\t\t}\n\t};\n\trequest.open(options.method || 'GET', url, true);\n\n\tif( options.method && options.method.toUpperCase() === 'POST' ) {\n\t\trequest.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded; charset=UTF-8');\n\t}\n\n\trequest.send( options.data || {} );\n\treturn request;\n}\n\nmodule.exports = request;\n},{}],3:[function(require,module,exports){\n'use strict';\n\n\nvar ProgressBar = require('./_progress-bar.js');\nvar request = require('./_request.js');\nvar count = mc4wp_ecommerce.untracked_order_count;\nvar form = document.getElementById('add-untracked-orders-form');\nvar progressBarMount = document.getElementById('add-untracked-orders-progress');\nvar progress_bar,\n\tprogress_poll,\n\tworker;\n\n// hook into form submit\nif( form ) {\n\tform.addEventListener('submit', start );\n}\n\nfunction start(e) {\n\n\t// prevent default form submit\n\te.preventDefault();\n\n\tvar button = form.querySelector('input[type=\"submit\"]');\n\tbutton.setAttribute('disabled', true);\n\n\t// init progress bar\n\tprogress_bar = new ProgressBar(progressBarMount, count);\n\tprogress_poll = window.setTimeout(fetchProgress, 500);\n\twork();\n}\n\nfunction work() {\n\tvar limit = parseInt( form.elements[\"limit\"].value );\n\tvar offset = parseInt( form.elements[\"offset\"].value );\n\tvar url = ajaxurl + \"?action=mc4wp_ecommerce_add_untracked_orders&offset=\" + offset + \"&limit=\" + limit;\n\tvar previousCount = count;\n\n\tworker = request( url, {\n\t\tonSuccess: function(data) {\n\t\t\tupdateProgress(data);\n\n\t\t\tif( previousCount <= data ) {\n\t\t\t\t// We're not making progress..\n\t\t\t\tvar textElement = document.createElement('p');\n\t\t\t\ttextElement.style.color = 'red';\n\t\t\t\ttextElement.innerHTML = \"We're stuck. Please <a href=\\\"admin.php?page=mailchimp-for-wp-other\\\">check the debug log</a> for errors.\";\n\t\t\t\tprogressBarMount.parentNode.appendChild(textElement);\n\t\t\t} else if( data > 0 ) {\n\t\t\t\t// Keep going if there's more\n\t\t\t\twork();\n\t\t\t}\n\t\t},\n\n\t\tonError: function( code, response ) {\n\t\t\t// if we got a 504 Gateway Timeout, try again.\n\t\t\tif( code == 504 ) {\n\t\t\t\twork();\n\t\t\t}\n\t\t}\n\t});\n}\n\nfunction updateProgress(new_count) {\n\tprogress_bar.tick( count - new_count );\n\tcount = new_count;\n}\n\nfunction fetchProgress() {\n\tif( progress_bar.done() ) {\n\n\t\t// refresh page\n\t\twindow.setTimeout( function() {\n\t\t\twindow.location.reload()\n\t\t}, 2500 );\n\n\t\treturn;\n\t}\n\n\tvar url = ajaxurl + \"?action=mc4wp_ecommerce_get_untracked_orders_count\";\n\trequest( url, {\n\t\tonSuccess: function(data) {\n\t\t\tupdateProgress(data);\n\t\t\twindow.setTimeout( fetchProgress, 2000 );\n\t\t}\n\t});\n}\n},{\"./_progress-bar.js\":1,\"./_request.js\":2}]},{},[3]);\n })();"]}